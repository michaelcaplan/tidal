enum ActionKind {
    Walking,
    Idle,
    Jumping,
    Intro
}
namespace SpriteKind {
    export const Splash = SpriteKind.create()
    export const benchBar = SpriteKind.create()
}
function squatStart () {
    scene.setBackgroundImage(assets.image`backHolder`)
    music.play(music.melodyPlayable(music.magicWand), music.PlaybackMode.InBackground)
    pauseUntil(() => controller.A.isPressed())
    callGameSelector()
}
function benchLoop () {
    benchGameLoopCurrent = game.runtime() - benchGameLoopLast
    benchGameLoopHealthCurrent = game.runtime() - benchGameLoopHealthLast
    benchBarHeight = (benchLeftSprite.y + benchRightSprite.y) / 2
    benchCurrentWeight = 135 + benchLevel * 10
    if (benchState == "press") {
        if (benchGameLoopHealthCurrent >= 150) {
            benchGameLoopHealthLast = game.runtime()
            benchStatusBar.value += -1
            if (benchStatusBar.value == 0) {
                music.stopAllSounds()
                if (info.score() == 0) {
                    game.gameOver(false)
                } else {
                    game.gameOver(true)
                }
            }
        }
        if (benchGameLoopCurrent >= 1000) {
            benchGameLoopLast = game.runtime()
            if (benchLeftSprite.y <= benchBarTop && benchRightSprite.y <= benchBarTop) {
                benchState = "pressed"
                benchRightSprite.y = benchBarTop
                benchLeftSprite.y = benchBarTop
                benchUpdateHud()
            }
            benchGravity = benchCurrentWeight * 0.01
            // Mid point stick
            if (benchBarHeight > benchBarMidTop && benchBarHeight < benchBarMidBottom) {
                benchGravity = benchGravity * 1.5
            }
            benchTilt = Math.abs(benchLeftSprite.y - benchRightSprite.y)
            benchMaxTilt = 20 - benchCurrentWeight / 20
            if (benchTilt > benchMaxTilt) {
                // Severe penalty for uneven lifting
                benchGravity = benchGravity * 2
            }
            if (benchLeftSprite.y < benchBarBottom) {
                benchLeftSprite.y = benchLeftSprite.y + benchGravity
            } else {
                benchLeftSprite.y = benchBarBottom
            }
            if (benchRightSprite.y < benchBarBottom) {
                benchRightSprite.y = benchRightSprite.y + benchGravity
            } else {
                benchRightSprite.y = benchBarBottom
            }
        }
    } else if (benchState == "decend") {
        benchLeftSprite.vy = 60
        benchRightSprite.vy = 60
        if (benchBarHeight >= benchBarBottom) {
            benchLeftSprite.vy = 0
            benchLeftSprite.y = benchBarBottom
            benchRightSprite.vy = 0
            benchRightSprite.y = benchBarBottom
            benchState = "press"
        }
    } else {
    	
    }
    benchUpdateBar()
    benchUpdateArms()
    benchUpdateHud()
}
function benchUpdateBar () {
    benchBarSprite.y = (benchLeftSprite.y + benchRightSprite.y) / 2
    transformSprites.rotateSprite(benchBarSprite, benchRightSprite.y - benchLeftSprite.y)
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameSelected == "Bench Press") {
        benchBButton()
    }
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameSelected == "Bench Press") {
        benchAButton()
    }
})
function benchAButton () {
    if (benchState == "press") {
        if (benchLeftSprite.y > benchBarTop) {
            benchLeftSprite.y += -1
        }
    } else if (benchState == "racked") {
        benchState = "unracked"
        music.play(music.createSoundEffect(WaveShape.Noise, 3900, 3500, 255, 0, 10, SoundExpressionEffect.None, InterpolationCurve.Linear), music.PlaybackMode.InBackground)
        benchLeftSprite.y += -5
        benchRightSprite.y += -5
    } else if (benchState == "unracked") {
        benchState = "decend"
    } else if (benchState == "pressed") {
        benchState = "done"
        music.play(music.createSoundEffect(WaveShape.Noise, 3900, 3500, 255, 0, 10, SoundExpressionEffect.None, InterpolationCurve.Linear), music.PlaybackMode.InBackground)
        benchLeftSprite.y += 5
        benchRightSprite.y += 5
    } else {
    	
    }
}
function clearSplash () {
    music.stopAllSounds()
    music.play(music.melodyPlayable(music.powerUp), music.PlaybackMode.InBackground)
    sprites.destroyAllSpritesOfKind(SpriteKind.Splash, effects.spray, 500)
    sprites.destroy(splashStart, effects.spray, 500)
}
function benchStart () {
    music.play(music.stringPlayable(music.convertRTTTLToMelody("ExciteBi:d=4,o=5,b=90:32p,16e,32p,16g,32p,16c6,32p,32e,32p,16g,32p,16c6,p,16g#,32p,16b,32p,16e6,32p,32g#,32p,16b,32p,16e6,p,32d6,32p,32c6,32p,32d6,32p,32c6,32p,32a,32p,32g,32p,32f,32p,32f,32p,32e,32p,32d#,32p,32d,16p,32c,32p,32e,32p,32f,32p,32f#,32p,32g,32p,16c6"), 120), music.PlaybackMode.LoopingInBackground)
    scene.setBackgroundImage(assets.image`benchBackground`)
    benchState = "racked"
    benchBarTop = 35
    benchBarMidBottom = 50
    benchBarMidTop = 40
    benchBarBottom = 60
    benchLevel = 1
    benchPlayerSprite = sprites.create(assets.image`benchPlayer`, SpriteKind.Player)
    benchPlayerSprite.setPosition(80, 70)
    benchPlayerSprite.z = 10
    benchLeftArmSprite = sprites.create(img`
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        `, SpriteKind.Player)
    benchLeftArmSprite.setPosition(65, 70)
    benchLeftArmSprite.z = 0
    benchRightArmSprite = sprites.create(img`
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        . . . . . . . . . . 
        `, SpriteKind.Player)
    benchRightArmSprite.setPosition(90, 70)
    benchRightArmSprite.z = 0
    benchStatusBar = statusbars.create(40, 4, StatusBarKind.Health)
    benchStatusBar.value = 100
    benchStatusBar.positionDirection(CollisionDirection.Bottom)
    benchStatusBar.setOffsetPadding(0, 5)
    benchStatusBar.attachToSprite(benchPlayerSprite)
    benchRightSprite = sprites.create(assets.image`rightHand`, SpriteKind.benchBar)
    benchRightSprite.setPosition(110, 40)
    benchLeftSprite = sprites.create(assets.image`leftHand`, SpriteKind.benchBar)
    benchLeftSprite.setPosition(50, 40)
    benchBarSprite = sprites.create(assets.image`benchBar`, SpriteKind.benchBar)
    benchBarSprite.setPosition(80, 40)
    benchBarSprite.z = -10
    benchHudLevel = textsprite.create("Entering Level", 15, 0)
    benchHudLevel.setPosition(50, 110)
    benchHudWeight = textsprite.create("Weight ?", 15, 0)
    benchHudWeight.setPosition(100, 110)
    benchHudAction = textsprite.create("Ready?", 15, 0)
    benchHudAction.setPosition(80, 10)
}
function callGameSelector () {
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    gameSelectorSprite = miniMenu.createMenu(
    miniMenu.createMenuItem("Bench Press", assets.image`gameBench`),
    miniMenu.createMenuItem("Back Squat", assets.image`gameSquat`),
    miniMenu.createMenuItem("Deadlift", assets.image`gameDeadlift`)
    )
    gameSelectorSprite.setDimensions(140, 90)
    gameSelectorSprite.setTitle("Pick Your Lift")
    gameSelectorSprite.setStyleProperty(miniMenu.StyleKind.Default, miniMenu.StyleProperty.Background, 9)
    gameSelectorSprite.setStyleProperty(miniMenu.StyleKind.Selected, miniMenu.StyleProperty.Background, 8)
    gameSelectorSprite.setPosition(80, 60)
    gameSelectorSprite.setFrame(assets.image`gameMenuBack`)
    gameSelectorSprite.onButtonPressed(controller.A, function (selection, selectedIndex) {
        timer.debounce("action", 250, function () {
            gameSelected = selection
            gameSelectorSprite.close()
            if (selectedIndex == 0) {
                benchStart()
            } else if (selectedIndex == 1) {
                squatStart()
            } else if (selectedIndex == 2) {
                deadliftStart()
            }
        })
    })
}
function splash () {
    music.play(music.stringPlayable(music.convertRTTTLToMelody("MortalKo:d=4,o=6,b=35:32a#5,32a#5,32c#6,32a#5,32d#6,32a#5,32f6,32d#6,32c#6,32c#6,32f6,32c#6,32g#6,32c#6,32f6,32c#6,32g#5,32g#5,32c6,32g#5,32c#6,32g#5,32d#6,32c#6,32f#5,32f#5,32a#5,32f#5,32c#6,32f#5,32c#6,32c6,32a#5,32a#5,32c#6,32a#5,32d#6,32a#5,32f6,32d#6,32c#6,32c#6,32f6,32c#6,32g#6,32c#6,32f6,32c#6,32g#5,32g#5,32c6,32g#5,32c#6,32g#5,32d#6,32c#6,32f#5,32f#5,32a#5,32f#5,32c#6,32f#5,32c#6,32c6"), 120), music.PlaybackMode.LoopingInBackground)
    splashTidal = sprites.create(assets.image`tidal`, SpriteKind.Splash)
    splashTidal.setScale(0.25, ScaleAnchor.Middle)
    splashTidal.setPosition(80, 64)
    splashTitle = sprites.create(assets.image`title-1`, SpriteKind.Splash)
    splashTitle.setPosition(80, 16)
    splashTitleAnimation = animation.createAnimation(ActionKind.Walking, 500)
    splashTitleAnimation.addAnimationFrame(assets.image`title-1`)
    splashTitleAnimation.addAnimationFrame(assets.image`title-2`)
    animation.attachAnimation(splashTitle, splashTitleAnimation)
    animation.setAction(splashTitle, ActionKind.Walking)
    splashStart = textsprite.create(" To Start", 0, 8)
    splashStart.setMaxFontHeight(10)
    splashStart.setIcon(assets.image`abutton`)
    splashStart.setPosition(80, 104)
}
function benchUpdateHud () {
    benchHudLevel.setText("Level " + benchLevel)
    benchHudWeight.setText("Weight " + benchCurrentWeight + "LBs")
    if (benchState == "racked") {
        benchHudAction.setText("Press A To Unrack")
        benchHudAction.setPosition(80, 10)
    } else if (benchState == "press") {
        if (benchTilt > benchMaxTilt) {
            benchHudAction.setText("UNEVEN!!!!")
            benchHudAction.setPosition(80, 10)
        } else {
            benchHudAction.setText("PUSH!! (A+B)")
            benchHudAction.setPosition(80, 10)
        }
    } else if (benchState == "unracked") {
        benchHudAction.setText("Press A To Descend")
        benchHudAction.setPosition(80, 10)
    } else if (benchState == "unracked") {
        benchHudAction.setText("DESCENDING!")
        benchHudAction.setPosition(80, 10)
    } else if (benchState == "pressed") {
        benchHudAction.setText("Press A to Re-Rack")
        benchHudAction.setPosition(80, 10)
    } else if (benchState == "done") {
        music.play(music.stringPlayable("E D G F B A C5 B ", 260), music.PlaybackMode.UntilDone)
        info.changeScoreBy(benchCurrentWeight)
        game.splash("An Easy " + benchCurrentWeight + "LBs!", "Lets go for " + (benchCurrentWeight + 10) + "LBs")
        benchState = "racked"
        benchLevel += 1
        benchStatusBar.value = 100
    }
    benchRightSprite.sayText(benchGravity)
    benchRightSprite.setFlag(SpriteFlag.ShowPhysics, true)
    benchLeftSprite.sayText(benchBarHeight)
}
function deadliftStart () {
    scene.setBackgroundImage(assets.image`deadliftHolder`)
    music.play(music.melodyPlayable(music.magicWand), music.PlaybackMode.InBackground)
    pauseUntil(() => controller.A.isPressed())
    callGameSelector()
}
function benchBButton () {
    if (benchState == "press") {
        if (benchRightSprite.y > benchBarTop) {
            benchRightSprite.y += -1
        }
    }
}
function benchUpdateArms () {
    benchLeftArm = image.create(15, benchPlayerSprite.y - benchBarSprite.y)
    benchLeftArm.drawLine(0, 0, image.getDimension(benchLeftArm, image.Dimension.Width), image.getDimension(benchLeftArm, image.Dimension.Height), 13)
    benchLeftArmSprite.setImage(benchLeftArm)
    benchLeftArmSprite.top = benchBarSprite.bottom
    benchRightArm = image.create(15, benchPlayerSprite.y - benchBarSprite.y)
    benchRightArm.drawLine(image.getDimension(benchRightArm, image.Dimension.Width), 0, 0, image.getDimension(benchRightArm, image.Dimension.Height), 13)
    benchRightArmSprite.setImage(benchRightArm)
    benchRightArmSprite.top = benchBarSprite.bottom
}
let benchRightArm: Image = null
let benchLeftArm: Image = null
let splashTitleAnimation: animation.Animation = null
let splashTitle: Sprite = null
let splashTidal: Sprite = null
let gameSelectorSprite: miniMenu.MenuSprite = null
let benchHudAction: TextSprite = null
let benchHudWeight: TextSprite = null
let benchHudLevel: TextSprite = null
let benchRightArmSprite: Sprite = null
let benchLeftArmSprite: Sprite = null
let benchPlayerSprite: Sprite = null
let splashStart: TextSprite = null
let gameSelected = ""
let benchBarSprite: Sprite = null
let benchBarBottom = 0
let benchMaxTilt = 0
let benchTilt = 0
let benchBarMidBottom = 0
let benchBarMidTop = 0
let benchGravity = 0
let benchBarTop = 0
let benchStatusBar: StatusBarSprite = null
let benchState = ""
let benchLevel = 0
let benchCurrentWeight = 0
let benchRightSprite: Sprite = null
let benchLeftSprite: Sprite = null
let benchBarHeight = 0
let benchGameLoopHealthLast = 0
let benchGameLoopHealthCurrent = 0
let benchGameLoopLast = 0
let benchGameLoopCurrent = 0
splash()
pauseUntil(() => controller.A.isPressed())
clearSplash()
callGameSelector()
game.onUpdate(function () {
    if (gameSelected == "Bench Press") {
        benchLoop()
    }
})
